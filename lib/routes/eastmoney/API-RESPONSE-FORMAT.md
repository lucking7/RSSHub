# 东方财富行情API返回格式详解

## API基本信息

**接口地址:** `https://push2.eastmoney.com/api/qt/clist/get`

**请求方式:** GET

**响应格式:** JSONP (需要去掉 `callback()` 包装)

---

## 一、完整响应结构

```json
{
  "rc": 0,              // 返回码 (0表示成功)
  "rt": 6,              // 响应时间
  "svr": 180606386,     // 服务器ID
  "lt": 1,              //
  "full": 1,            //
  "dlmkts": "",         //
  "data": {
    "total": 2,         // 总数量
    "diff": [           // 数据数组
      {
        // 各个字段详见下文
      }
    ]
  }
}
```

---

## 二、数据字段详解 (diff数组中的对象)

### 1️⃣ 基础标识字段

| 字段 | 说明 | 示例值 | 备注 |
|------|------|--------|------|
| f1 | 小数位数 | 2 | 用于格式化价格 |
| f12 | 代码 | "000001" | 股票/指数代码 |
| f13 | 市场代码 | 1 | 1=上海, 0=深圳, 100=港美股 |
| f14 | 名称 | "上证指数" | 显示名称 |
| f107 | 交易状态 | 2 | 1=交易中, 2=?, 3=休市, 5=已收盘 |
| f152 | 精度 | 2 | 备用精度字段 |

### 2️⃣ 价格字段 (核心)

| 字段 | 说明 | 指数示例 | 个股示例 | 状态 |
|------|------|---------|---------|------|
| f2 | 最新价 | 3984.44 | 1445.0 | ✅ 必有 |
| f3 | 涨跌幅% | -0.31 | 0.32 | ✅ 必有 |
| f4 | 涨跌额 | -12.5 | 4.59 | ✅ 必有 |
| f15 | 最高价 | 4000.12 | 1450.0 | ✅ 必有 |
| f16 | 最低价 | 3980.00 | 1440.0 | ✅ 必有 |
| f17 | 今开价 | 3990.00 | 1442.0 | ✅ 必有 |
| f18 | 昨收价 | 3996.94 | 1440.41 | ✅ 必有 |

### 3️⃣ 成交数据

| 字段 | 说明 | 指数示例 | 单位 | 状态 |
|------|------|---------|------|------|
| f5 | 成交量 | 556549051 | 手 | ✅ 必有 |
| f6 | 成交额 | 909532039055.6 | 元 | ✅ 必有 |
| f7 | 换手率% | 0.85 | % | ✅ 必有 |
| f8 | 振幅% | 1.17 | % | ✅ 可用 |

### 4️⃣ 市场指标

| 字段 | 说明 | 示例值 | 状态 |
|------|------|--------|------|
| f10 | 量比 | 0.98 | ✅ 可用 |
| f11 | 委比% | 2.5 | ✅ 可用 |
| f22 | 涨速% | 0.05 | ✅ 可用 |

### 5️⃣ 估值指标 (重要！)

| 字段 | 说明 | 指数值 | 个股值 | 支持情况 |
|------|------|--------|--------|---------|
| f9 | 市盈率(动态) | "-" | 19.93 | ⚠️ 仅个股 |
| f115 | 市盈率(TTM) | "-" | 20.12 | ⚠️ 仅个股 |
| f23 | 市净率 | "-" | 7.58 | ⚠️ 仅个股 |
| f20 | 总市值 | 64271855751600 | 1809530460675 | ✅ 都支持 |
| f21 | 流通市值 | 60509870975524 | 1809530460675 | ✅ 都支持 |

### 6️⃣ 资金流向

| 字段 | 说明 | 示例值 | 单位 | 状态 |
|------|------|--------|------|------|
| f62 | 主力净流入 | -27716874240.0 | 元 | ✅ 都支持 |

### 7️⃣ 分类信息 (仅个股)

| 字段 | 说明 | 示例值 | 支持情况 |
|------|------|--------|---------|
| f128 | 领涨板块 | "白酒" | ⚠️ 仅个股 |
| f129 | 所属行业 | "食品饮料" | ⚠️ 仅个股 |
| f136 | 连板数 | 3 | ⚠️ 仅个股 |

---

## 三、实际数据示例

### 示例1: 上证指数 (指数类)

```json
{
  "f1": 2,
  "f2": 3984.44,              // 最新价
  "f3": -0.31,                // 涨跌幅%
  "f4": -12.5,                // 涨跌额
  "f5": 556549051,            // 成交量(手)
  "f6": 909532039055.6,       // 成交额(元)
  "f7": 0.85,                 // 换手率%
  "f8": 1.17,                 // 振幅%
  "f9": "-",                  // ❌ 市盈率(动态) - 指数无此数据
  "f10": 0.98,                // 量比
  "f12": "000001",            // 代码
  "f13": 1,                   // 市场: 上海
  "f14": "上证指数",          // 名称
  "f20": 64271855751600,      // ✅ 总市值 (约64.27万亿)
  "f21": 60509870975524,      // ✅ 流通市值 (约60.51万亿)
  "f23": "-",                 // ❌ 市净率 - 指数无此数据
  "f62": -27716874240.0,      // ✅ 主力净流入 (约-277亿)
  "f107": 2,                  // 交易状态
  "f115": "-",                // ❌ 市盈率(TTM) - 指数无此数据
  "f152": 2                   // 精度
}
```

### 示例2: 贵州茅台 (个股类)

```json
{
  "f1": 2,
  "f2": 1445.0,               // 最新价
  "f3": 0.32,                 // 涨跌幅%
  "f4": 4.59,                 // 涨跌额
  "f9": 19.93,                // ✅ 市盈率(动态)
  "f12": "600519",            // 代码
  "f13": 1,                   // 市场: 上海
  "f14": "贵州茅台",          // 名称
  "f20": 1809530460675,       // ✅ 总市值 (约1.81万亿)
  "f21": 1809530460675,       // ✅ 流通市值
  "f23": 7.58,                // ✅ 市净率
  "f62": 128788720.0,         // ✅ 主力净流入 (约1.29亿)
  "f107": 5,                  // 交易状态: 已收盘
  "f115": 20.12               // ✅ 市盈率(TTM)
}
```

---

## 四、字段支持矩阵

### 指数 (如上证、深证、道指、纳指)

| 类别 | 字段 | 支持 | 说明 |
|------|------|------|------|
| 价格 | f2, f3, f4, f15, f16, f17, f18 | ✅ | 全部支持 |
| 成交 | f5, f6, f7, f8 | ✅ | 全部支持 |
| 估值 | f20, f21 | ✅ | 仅市值 |
| 估值 | f9, f115, f23 | ❌ | 指数无市盈率/市净率 |
| 资金 | f62, f10 | ✅ | 全部支持 |

### 个股 (如贵州茅台、苹果、特斯拉)

| 类别 | 字段 | 支持 | 说明 |
|------|------|------|------|
| 价格 | f2, f3, f4, f15, f16, f17, f18 | ✅ | 全部支持 |
| 成交 | f5, f6, f7, f8 | ✅ | 全部支持 |
| 估值 | f9, f115, f23, f20, f21 | ✅ | **全部支持** |
| 资金 | f62, f10 | ✅ | 全部支持 |
| 分类 | f128, f129 | ✅ | 行业/板块 |

---

## 五、quotes.ts路由可以添加的字段

### ✅ 推荐添加 (高优先级)

这些字段对**指数和个股都有数据**：

```typescript
// 1. 市值信息
f20: 总市值        // 指数✅ 个股✅
f21: 流通市值      // 指数✅ 个股✅

// 2. 资金流向
f62: 主力净流入    // 指数✅ 个股✅

// 3. 市场指标
f10: 量比          // 指数✅ 个股✅
f8:  振幅%         // 指数✅ 个股✅
```

### ⚠️ 谨慎使用 (仅个股有效)

这些字段只有**个股有数据**，指数会返回 `"-"`：

```typescript
f9:   市盈率(动态)  // 指数❌ 个股✅
f115: 市盈率(TTM)   // 指数❌ 个股✅
f23:  市净率        // 指数❌ 个股✅
f128: 领涨板块      // 指数❌ 个股✅
f129: 所属行业      // 指数❌ 个股✅
```

**建议处理方式**：
```typescript
// 智能显示：有数据就显示，没数据就隐藏该行
if (item.f9 !== '-' && item.f9 !== null) {
    // 显示市盈率
}
```

---

## 六、API请求示例

### 请求指数行情

```bash
curl "https://push2.eastmoney.com/api/qt/clist/get?\
pn=1&\
pz=10&\
po=1&\
np=1&\
fltt=2&\
invt=2&\
fs=i:1.000001,i:0.399001,i:100.DJIA&\
fields=f1,f2,f3,f4,f5,f6,f7,f8,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f62,f107,f152&\
ut=13697a1cc677c8bfa9a496437bfef419&\
cb=jQuery"
```

### 请求个股行情

```bash
curl "https://push2.eastmoney.com/api/qt/clist/get?\
pn=1&\
pz=1&\
po=1&\
np=1&\
fltt=2&\
invt=2&\
fs=i:1.600519&\
fields=f1,f2,f3,f4,f9,f115,f23,f20,f21,f62,f12,f13,f14,f107,f128,f129&\
ut=13697a1cc677c8bfa9a496437bfef419&\
cb=jQuery"
```

---

## 七、数据处理注意事项

### 1. JSONP格式处理

```typescript
let data = response.data;
if (typeof data === 'string') {
    const match = data.match(/jQuery\((.*)\)/);
    if (match) {
        data = JSON.parse(match[1]);
    }
}
```

### 2. 数值为 "-" 的处理

```typescript
// 判断字段是否有效
const hasValue = (val) => {
    return val !== '-' && val !== null && val !== undefined && val !== '';
};

// 使用示例
if (hasValue(item.f9)) {
    // 显示市盈率
}
```

### 3. 大数字格式化

```typescript
const formatAmount = (amt) => {
    if (!amt || amt === '-') return '-';
    const num = Number(amt);
    if (num >= 1e12) return `${(num / 1e12).toFixed(2)}万亿`;
    if (num >= 1e8) return `${(num / 1e8).toFixed(2)}亿`;
    if (num >= 1e4) return `${(num / 1e4).toFixed(2)}万`;
    return num.toFixed(2);
};

// 示例
formatAmount(64271855751600)  // "64.27万亿"
formatAmount(1809530460675)   // "1.81万亿"
formatAmount(-27716874240)    // "-277.17亿"
```

---

## 八、总结

### ✅ API完全支持的功能

1. **行情路由添加估值指标**
   - ✅ 总市值 (f20) - 指数和个股都支持
   - ✅ 流通市值 (f21) - 指数和个股都支持
   - ⚠️ 市盈率/市净率 - 仅个股支持，指数返回 "-"

2. **行情路由添加资金流向**
   - ✅ 主力净流入 (f62) - 指数和个股都支持
   - ✅ 量比 (f10) - 指数和个股都支持

### 📝 实现建议

对于 `quotes.ts` 路由（主要面向指数）：

**推荐添加（所有品种都支持）：**
- 总市值 (f20)
- 流通市值 (f21)
- 主力净流入 (f62)
- 量比 (f10)
- 振幅 (f8)

**不推荐添加（指数无数据）：**
- 市盈率 (f9, f115)
- 市净率 (f23)
- 行业板块 (f128, f129)

---

**文档更新时间**: 2025-10-28
**测试数据来源**: 东方财富实时行情API
