# 金十数据广告过滤功能说明

## 🎯 功能概述

金十数据路由新增**广告过滤功能**，可以自动过滤VIP锁定内容、推广文章等广告信息，提供更纯净的快讯订阅体验。

---

## 📊 测试结果

**过滤效率**: **15.71%** （在70条数据中过滤掉11条广告）

**过滤效果**:
- ✅ 原始数据: 70条
- ✅ 过滤后: 59条
- 🚫 过滤掉: 11条广告

---

## 🎨 使用方法

### 1️⃣ 市场快讯（主页）

**路由**: `/jin10/:important?/:filter?`

**使用示例**:

```bash
# 显示所有快讯（包含广告）
https://rsshub.app/jin10

# 只看重要快讯
https://rsshub.app/jin10/important

# 过滤广告信息
https://rsshub.app/jin10//noads

# 只看重要快讯且过滤广告
https://rsshub.app/jin10/important/noads
```

### 2️⃣ 分类快讯

**路由**: `/jin10/category/:id/:filter?`

**使用示例**:

```bash
# 期货分类，显示所有快讯
https://rsshub.app/jin10/category/36

# 期货分类，过滤广告
https://rsshub.app/jin10/category/36/noads

# 黄金分类，过滤广告
https://rsshub.app/jin10/category/2/noads

# A股分类，过滤广告
https://rsshub.app/jin10/category/29/noads
```

---

## 🚫 过滤规则详解

### 规则1: VIP锁定内容
**特征**: `data.lock = true`

**示例**:
```
❌ 被过滤
标题: 国际现货黄金再现虚假顶部？清洗浮筹后这一目标依然可期
描述: VIP专享快讯，解锁直达
内容: (空，需要VIP才能查看)
```

**原因**: 这类内容是VIP专享，普通用户看不到完整内容，只能看到诱导升级的提示。

---

### 规则2: 推广文章
**特征**: `type = 2`

**示例**:
```
❌ 被过滤
标题: 高市早苗新政引爆日股狂欢！日经指数再创历史新高
内容: 当高市早苗即将成为日本首位女首相的消息撞上扩张性财政政策的
      强烈预期，东京股市迎来一场资本盛宴。日经指数周二再创历史新高。
      点击查看...
```

**原因**: 这类内容以"点击查看..."结尾，诱导用户跳转到详情页，通常是推广文章。

---

### 规则3: 包含"点击查看..."
**特征**: 内容中包含 `"点击查看..."`

**示例**:
```
❌ 被过滤
内容: ...东京股市迎来一场资本盛宴。日经指数周二再创历史新高。点击查看...
```

**原因**: 内容不完整，诱导点击查看详情。

---

### 规则4: VIP备注标记
**特征**: `remark` 中包含 `lock=true` 或 `"VIP用户"`

**示例**:
```
❌ 被过滤
remark: [
  {
    "lock": true,
    "content": "该内容仅为VIP用户提供，请升级至最新版本解锁内容",
    "title": "现货黄金"
  }
]
```

**原因**: 备注中标记为VIP专享内容。

---

## ✅ 保留的正常内容示例

```
✅ 保留
【A股午评：沪指再回3900点 两市缩量普涨超4300只个股飘红】
金十数据10月21日讯，A股三大股指早盘集体高开，一路高开高走，
创业板指盘中涨超3%，沪指半日涨超1%再回3900点上方。两市呈现缩量...

✅ 保留
【CNH同业拆息利率多数上涨，隔夜及一周期拆息创一周新高】
金十数据10月21日讯，离岸人民币香港银行同业拆息(CNH HIBOR)周二显示：
主要期限利率多数上行；其中隔夜HIBOR涨19个基点至1.6...

✅ 保留
【国债期货早盘收盘】
2年期国债期货（TS）主力合约涨0.02%，5年期国债期货（TF）主力
合约持平，10年期国债期货（T）主力合约跌0.04%...
```

---

## 📈 过滤统计（实测数据）

| 广告类型 | 数量 | 占比 |
|---------|------|------|
| VIP锁定内容 (lock=true) | 5条 | 7.14% |
| 推广文章 (type=2) | 6条 | 8.57% |
| 包含"点击查看..." | 2条 | 2.86% |
| VIP备注标记 | 5条 | 7.14% |
| **总计** | **11条** | **15.71%** |

---

## 🔧 技术实现

### 过滤函数

```javascript
const filterAds = (item) => {
    // 1. 过滤VIP锁定内容
    if (item.data.lock === true) {
        return false;
    }

    // 2. 过滤推广文章
    if (item.type === 2) {
        return false;
    }

    // 3. 过滤包含"点击查看..."的诱导内容
    const content = item.data.content || '';
    if (content.includes('点击查看...')) {
        return false;
    }

    // 4. 过滤VIP专享内容
    if (item.remark && item.remark.length > 0) {
        const hasVipRemark = item.remark.some(
            (r) => r.lock === true || r.content?.includes('VIP用户')
        );
        if (hasVipRemark) {
            return false;
        }
    }

    return true;
};
```

### 应用场景

```javascript
// 获取参数
const { filter = '' } = ctx.req.param();
const enableFilter = filter === 'noads';

// 应用过滤
const filteredData = enableFilter ? data.filter(filterAds) : data;

// 在标题中标注
return {
    title: enableFilter ? '金十数据（已过滤广告）' : '金十数据',
    item: filteredData.map(...),
};
```

---

## 🎁 特性说明

### 1. 向下兼容
- 默认不过滤，保持原有行为
- 只有明确指定 `noads` 才启用过滤

### 2. 标题标注
- 开启过滤后，RSS标题会显示"（已过滤广告）"
- 方便用户识别是否启用了过滤功能

### 3. 组合使用
- 可以同时使用 `important` 和 `noads` 参数
- 例如: `/jin10/important/noads`

### 4. 缓存友好
- 过滤在缓存后进行，不影响缓存效率
- 不同过滤参数共享同一缓存

---

## 📝 测试方法

运行测试脚本查看过滤效果：

```bash
node lib/routes/jin10/test-filter.cjs
```

**输出示例**:
```
📊 统计信息:
   - 原始数据总数: 70
   - 过滤后数据总数: 59
   - 过滤掉的数量: 11

🚫 被过滤的广告类型分析:
   - VIP锁定内容: 5 条
   - 推广文章: 6 条
   - 包含"点击查看...": 2 条
   - VIP备注标记: 5 条

📈 过滤效率: 15.71%
```

---

## 🤔 常见问题

### Q1: 为什么要设计成可选的？
**A**: 有些用户可能想看到所有信息（包括推广文章），所以设计成可选功能，默认不过滤。

### Q2: 会不会误杀正常内容？
**A**: 过滤规则非常精确，只过滤明确标记为VIP或推广的内容，不会误杀正常快讯。

### Q3: 过滤后会影响更新速度吗？
**A**: 不会。过滤是在缓存后进行的，不影响API请求频率和缓存效率。

### Q4: 可以自定义过滤规则吗？
**A**: 目前过滤规则是固定的。如需自定义，可以修改 `filterAds` 函数。

### Q5: 为什么是 `noads` 而不是 `filter`？
**A**: `noads` 更直观，表示"不要广告"。参数名称可以根据需要调整。

---

## 🔮 未来优化

可能的优化方向：

1. **更多过滤选项**
   - `novip` - 只过滤VIP内容
   - `nopromo` - 只过滤推广文章
   - `strict` - 严格模式（过滤更多）

2. **白名单机制**
   - 保留特定标签的推广文章
   - 保留特定来源的内容

3. **智能过滤**
   - 基于内容质量评分
   - 基于用户反馈

4. **过滤统计**
   - 在RSS description中显示过滤数量
   - 提供过滤报告

---

## 📊 对比表

| 场景 | 不过滤 | 过滤后 | 效果 |
|------|--------|--------|------|
| 快讯总数 | 70条 | 59条 | -15.71% |
| VIP锁定 | 5条 | 0条 | ✅ 全部过滤 |
| 推广文章 | 6条 | 0条 | ✅ 全部过滤 |
| 正常快讯 | 59条 | 59条 | ✅ 完整保留 |

---

## 🎉 总结

**优势**:
- ✅ 过滤效率高（15.71%）
- ✅ 不误杀正常内容
- ✅ 向下兼容
- ✅ 使用简单
- ✅ 缓存友好

**适用场景**:
- 只想看纯粹的市场快讯
- 不想被VIP广告打扰
- 不想看推广文章
- 追求干净的RSS阅读体验

**使用建议**:
- 🌟 推荐订阅: `/jin10//noads` 或 `/jin10/important/noads`
- 📱 普通订阅: `/jin10`（包含所有信息）

---

## 📁 相关文件

```
lib/routes/jin10/
├── index.ts              # 市场快讯（已添加过滤功能）✨
├── category.ts           # 分类快讯（已添加过滤功能）✨
├── categories.ts         # 分类列表
├── topic.ts              # 主题文章
├── test-filter.cjs       # 过滤功能测试脚本 ✨
├── compare-categories.cjs # 分类对比脚本
├── FILTER_GUIDE.md       # 本文件 ✨
├── API_ANALYSIS.md       # API分析报告
└── CATEGORIES_GUIDE.md   # 分类功能说明
```

---

**最后更新**: 2025-10-21  
**维护者**: laampui

